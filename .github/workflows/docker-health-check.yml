name: Docker Health Check

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  health-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: Docker Compose ì„¤ì • ê²€ì¦
      run: |
        echo "âœ… Docker Compose íŒŒì¼ êµ¬ë¬¸ ê²€ì¦"
        docker compose config --quiet
        echo "âœ… ê°œë°œí™˜ê²½ ì„¤ì • ê²€ì¦"
        docker compose -f docker-compose.development.yml config --quiet
        echo "âœ… ìš´ì˜í™˜ê²½ ì„¤ì • ê²€ì¦"  
        docker compose -f docker-compose.production.yml config --quiet
        
    - name: í—¬ìŠ¤ì²´í¬ ì‹œë®¬ë ˆì´ì…˜
      run: |
        echo "ğŸ” AI ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬ ì‹œë®¬ë ˆì´ì…˜"
        echo "- ì²´í¬ ëŒ€ìƒ: http://localhost:8000/health"
        echo "- ì˜ˆìƒ ì‘ë‹µ: {\"status\": \"healthy\", \"service\": \"ururu-ai-recommendation\"}"
        
        echo "ğŸ” Spring Backend ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜"
        echo "- ì²´í¬ ëŒ€ìƒ: http://localhost:8080/health"
        echo "- ì‹¤ì œ ì—°ê²°ì€ EC2 í™˜ê²½ì—ì„œë§Œ ê°€ëŠ¥"
        
    - name: GitHub Container Registry ì´ë¯¸ì§€ í™•ì¸
      run: |
        echo "ğŸ“¦ ìµœì‹  Docker ì´ë¯¸ì§€ í™•ì¸"
        echo "- Registry: ghcr.io/${{ github.repository }}"
        echo "- ìµœì‹  íƒœê·¸: latest, main, develop"
        
    - name: í—¬ìŠ¤ì²´í¬ ë³´ê³ ì„œ
      run: |
        echo "ğŸ“Š í—¬ìŠ¤ì²´í¬ ì™„ë£Œ ë³´ê³ ì„œ"
        echo "âœ… Docker Compose ì„¤ì • íŒŒì¼ ì •ìƒ"
        echo "âœ… ì›Œí¬í”Œë¡œìš° ì„¤ì • ì •ìƒ"
        echo "âš ï¸  ì‹¤ì œ ì„œë¹„ìŠ¤ ìƒíƒœëŠ” EC2ì—ì„œ ë³„ë„ í™•ì¸ í•„ìš”"
        echo "ğŸ’¡ EC2ì—ì„œ ì‹¤í–‰: docker compose ps && docker compose logs"
